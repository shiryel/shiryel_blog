<!DOCTYPE html><html lang="en"><head><title>Shiryel's Blog</title><link href="images/favicon-128.png" rel="icon" type="image/png"><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1.0" name="viewport"><meta content="A reminder on how to push a static website to AWS using github actions with the minimum of enfort" name="description"><meta content="aws, github actions" name="keywords"><meta content="How to push a static website to AWS using github actions" name="og:title"><meta content="A reminder on how to push a static website to AWS using github actions with the minimum of enfort" name="og:description"><meta content="article" name="og:type"><meta content="https://blog.shiryel.com/images/logo-512.png" name="og:image"><meta content="summary" name="twitter:card"><meta content="@shiryel_" name="twitter:site"><meta content="@shiryel_" name="twitter:creator"><link rel="stylesheet" media=all href="/css/reset-7ZRpbfeygfJQle-Usm3DWw==.css" />
<link rel="stylesheet" media=all href="/css/prism.min.css" />
<script  src="/js/prism.min.js"></script>
</head><body><div class="content"><a href="/">Back</a><h1 class="post">How to push a static website to AWS using github actions</h1><p class="date">2020-07-20</p><p>This is my personal default template for npm projects:</p>

<pre><code class="language-yml">name: Push to AWS [CD]

on:
  push:
    branches: [ master ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-node@v1
      with:
        node-version: 14.x 

    - name: NPM - install
      run: npm i

    - name: NPM - export
      run: npm run export

    - name: AWS - Set PEM
      run: |
        echo &quot;${{ secrets.AWS_PEM }}&quot; &gt; temp.pem
        chmod 400 temp.pem

    - name: AWS - Exclude last files if exists
      run: |
           ssh -q -o &quot;StrictHostKeyChecking no&quot; -i temp.pem ${{ secrets.AWS_SSH }} \\
             rm -r /www/shiryel_blog/*

    - name: AWS - Send new files to server
      if: success() || failure()
      run: |
        scp -o &quot;StrictHostKeyChecking no&quot; -i temp.pem  -r \\
          __sapper__/export/* ${{ secrets.AWS_SSH }}:/www/shiryel_blog/

    - name: AWS - Clear PEM
      if: always()
      run: rm -f temp.pem
</code></pre>

<p>So lets see what hapens here</p>

<h2>First, the scope</h2>

<pre><code class="language-yml">on:
  push:
    branches: [ master ]
</code></pre>

<p>This says to run this script when a push is made on the master branch</p>

<h2>Then the machine pre-config</h2>

<pre><code class="language-yml">jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-node@v1
      with:
        node-version: 14.x 
</code></pre>

<p>This says to run a countainer on ubuntu (latest version), get the code with checkout, and setup a node version 14</p>

<h2>NPM need to make the NPM things</h2>

<pre><code class="language-yml">    - name: NPM - install
      run: npm i
    
    - name: NPM - export
      run: npm run export
</code></pre>

<p>Yes</p>

<h2>AWS time, first the PEM</h2>

<p>With the PEM on hands, you add it on your github secrets (keep in mind that this aproach is for very small projects, you may want another aproach)
And create a PEM file on your machine</p>

<pre><code class="language-yml">    - name: AWS - Set PEM
      run: |
        echo &quot;${{ secrets.AWS_PEM }}&quot; &gt; temp.pem
        chmod 400 temp.pem
</code></pre>

<h2>Then I delete the current static files on AWS if it exists</h2>

<p>In my case I like to put the SSH connection (that who you get for connecting on the AWS with your PEM) as a secret (the AWS_SSH)</p>

<pre><code class="language-yml">    - name: AWS - Exclude last files if exists
      run: |
           ssh -q -o &quot;StrictHostKeyChecking no&quot; -i temp.pem ${{ secrets.AWS_SSH }} \\
             rm -r /www/shiryel_blog/*
</code></pre>

<p>And yes, make the path modifications for your own files</p>

<h2>Finally I send the files to the server</h2>

<pre><code class="language-yml">    - name: AWS - Send new files to server
      if: success() || failure()
      run: |
        scp -o &quot;StrictHostKeyChecking no&quot; -i temp.pem  -r \\
          __sapper__/export/* ${{ secrets.AWS_SSH }}:/www/shiryel_blog/
</code></pre>

<p>Modify the <code>__sapper__/export</code> and <code>/www/shiryel_blog</code> for your needs :)</p>

<h2>And even if it fails... remove the PEM</h2>

<pre><code class="language-yml">    - name: AWS - Clear PEM
      if: always()
      run: rm -f temp.pem
</code></pre>

<p>That is all folks, have a grat day :)</p>
<br /><a href="/">Back</a><style type="text/css">h1.post {
  text-align: center;
  margin-top: 1em;
}

p.date {
  text-align: center;
  margin-bottom: 2em;
}</style></div><footer><p><a href="https://github.com/shiryel/shiryel-blog" rel="noopener noreferrer" target="_blank">Hosted on Github</a></p><p>Copyright &copy; Shiryel</p><p><a href="https://github.com/still-ex/still" rel="noopener noreferrer" target="_blank">Made with Still</a></p></footer><style type="text/css">footer {
  display: flex;
  gap: 25px;
  text-align: center;
}</style></body></html><style type="text/css">body {
  display: flex;
  flex-direction: column;
  align-items: center;
  color: #FBFBFBba;
  background-image: radial-gradient(
    circle at center center,
    transparent 0%,
    rgb(33, 33, 33) 99%
    ),
    repeating-linear-gradient(
    0deg,
    rgba(163, 163, 163, 0.2) 0px,
    rgba(163, 163, 163, 0.2) 1px,
    transparent 1px,
    transparent 30px
    ),
    repeating-linear-gradient(
    90deg,
    rgba(163, 163, 163, 0.2) 0px,
    rgba(163, 163, 163, 0.2) 1px,
    transparent 1px,
    transparent 30px
    ),
    linear-gradient(90deg, rgb(33, 33, 33), rgb(33, 33, 33));
}

.content {
  background-color: #080A12;
  border-radius: 3px;
  padding: 20px;
  width: 90vw;
  max-width: 1000px;
}

@media (min-width: 768px) {
  .content{
    margin-top: 30px;
    padding: 30px 40px;
    min-height: 700px;
  }
}</style>